# 网络通讯

## 从计算机网络说起

计算机网络主要是由一些**通用的**、**可编程**的硬件互连而成, 通过这些硬件, 可以传送不同类型的数据, 并且可以支持广泛和日益增长的应用。

计算机网络按作用范围分为:

* **局域网LAN**
* **城域网MAN**
* **广域网WAN**

### 计算机网络模型

常见的网络模型有OSI七层模型、TCP/IP四层模型、因特网协议栈五层模型

* **OSI七层模型**分为物理层、数据链路层、网络层、传输层、会话层、表示层、应用层。
* **因特网协议栈五层模型**分为物理层、链路层、网络层、传输层、应用层。
* **TCP/IP四层模型**分为网络接口层、网络层、传输层、应用层

#### 物理层

物理层是规定**传输媒体接口**的标准。他并不管物理介质具体是什么, 比如电线杆上是光纤还是双绞线, 只要你能按物理层规定的标准传输数据就行。

传输比特流, 在物理层数据的基本单位称为比特(bit)

#### 数据链路层

帧是数据链路层数据的基本单位。数据链路层主要作用是在互连设备之间**传送数据帧**

> MAC地址是什么?
> MAC地址, 即设备的物理地址。MAC地址用于标示网卡, 每个网卡都具有唯一的MAC 地址。MAC 地址共有 48 位, 6 个字节。使用十六进制表示。比如 30-B4-9E-ED-85-CA

#### 网络层

网络层的作用主要是**地址管理**、**路由选择**和将数据帧封装成数据报。在网络层数据的基本单位被称为**数据报**, 包含**报头**和**数据**本身

> ip地址
> ipv4地址由4个字节组成,占32位, 分为两部分, 前面一部分代表网络号, 后面一部分代表主机号, 但是网络部分和主机部分所占用的二级制位数是不固定的

> * A 类: 1.0.0.0~126.255.255.255 （前面 1 个字节是网络号）
> * B 类: 128.0.0.0~191.255.255.255 （前面 2 个字节是网络号）
> * C 类: 192.0.0.0~223.255.255.255 （前面 3 个字节是网络号）
> * D 类: 224.0.0.0~239.255.255.255 用于组播
> * E 类: 240.0.0.0~254.255.255.255 用于科研

#### 传输层

传输层管理两个节点之间的数据传输, 提供可靠传输或者不可靠传输。主要是**TCP协议**和**UDP协议**

#### 应用层

应用层对应用程序的通信提供服务

## Web服务器工作原理

* **建立连接**: 客户端通过TCP/IP 协议建立到服务器的TCP连接
* **请求过程**（Request）: 客户端向服务器发送 HTTP 协议请求包, 请求服务器里的资源文档
* **响应过程**（Response）: 服务器在接收到用户的请求后, 会验证请求的有效性, 然后向用户发送相应的HTML文档
* **关闭连接**: 客户端与服务器断开

<div style="text-align: center;"><img alt='202403201555793' src='https://cdn.jsdelivr.net/gh/weno861/image/img/202403201555793.png' width=500px> </div>

### `URI`和`URL`

* URI的全称是(Uniform Resource Identifier), 中文名称是统一资源标识符, 使用它就能够唯一地标记互联网上资源。URI 不仅包括 URL, 还包括 URN(统一资源名称)

<div style="text-align: center;">     <img alt='202403201302855' src='https://cdn.jsdelivr.net/gh/weno861/image/img/202403201302855.png' width=500px> </div>

* URI 只能使用 ASCII, ASCII 之外的字符是不支持显示的, 而且还有一部分符号是界定符, 如果不加以处理就会导致解析出错。ASCII 是 7 比特字符集, 包含了 128 个不同的字符值。 ASCII 支持0-9的数字, A-Z大写和小写英文字母, 以及一些特殊字符。其中包括32个通用控制字符、10个十进制数码、52个英文大写小写字母和34个专用符号
* 因此, URI 引入了编码机制, 将所有非 ASCII 码字符和界定符转为十六进制字节值, 然后在前面加个%

<div style="text-align: center;">     <img alt='202403201305255' src='https://cdn.jsdelivr.net/gh/weno861/image/img/202403201305255.png'> </div>

### 请求

请求由客户端向服务器发出, 可以分为4部分内容:**请求方法**、**请求网址**、**请求头**和**请求体**

#### 请求方法

* 常见的请求方法有`get`和`post`两种
* 区别:
  * GET 请求包含的参数在url里面、数据可以在url看到, 而 POST 请求不能看到这些数据, 数据都是通过表单的形式传输
  * GET 请求提交的数据最多只有 1024 字节, 而 POST 方式没有限制

* 其他请求方法如下:

|序号|方法| 描述|
| :---| :--- |:---|
| 1| GET     | 请求指定的页面信息, 并返回实体主体。                                                       |
| 2    | HEAD    | 类似于 GET 请求, 只不过返回的响应中没有具体的内容, 用于获取报头                                       |
| 3    | POST    | 向指定资源提交数据进行处理请求（例如提交表单或者上传文件）。数据被包含在请求体中。POST 请求可能会导致新的资源的建立和/或已有资源的修改。  |
| 4    | PUT     | 从客户端向服务器传送的数据取代指定的文档的内容。                                                 |
| 5    | DELETE  | 请求服务器删除指定的页面。                                                            |
| 6    | CONNECT | HTTP/1.1 协议中预留给能够将连接改为管道方式的代理服务器。                                        |
| 7    | OPTIONS | 允许客户端查看服务器的性能。                                                           |
| 8    | TRACE   | 回显服务器收到的请求, 主要用于测试或诊断。                                                    |
| 9    | PATCH   | 是对 PUT 方法的补充, 用来对已知资源进行局部更新                                               |

#### 请求网址

即统一资源定位符`URL`,它可以唯一确定我们想请求的资源

#### 请求头

请求头, 用来说明服务器要使用的附加信息, 比较重要的信息有`Cookies`、`Referer`、`User-Agent`等等

下面简要说明一些常用的请求头信息

* `Accept`:请求报头域, 它说明了客户端可接受哪些类型的信息
* `Accept-Language`:指定客户端可接受的语言类型
* `Accept-Encoding`:指定客户端可接受的内容编码格式
* `Host`:指定请求资源的主机ip和端口号
* `Cookies`:**这是网站为了辨别用户进行会话跟踪而存储在用户本地的数据, 主要用于维持当前会话状态,保存登录信息等**
* `Referer`:标识请求是从哪个页面发过来的
* `User-Agent`:**识别用户使用的操作系统及版本、浏览器及版本等信息, 在爬虫时尽量加上该参数伪装成浏览器, 否则很可能被识别出为爬虫**

#### 请求体

请求体一般是表单数据,因此对于get请求来说, 请求体为空

### 响应

响应, 是指服务器返回给客户端的内容, 由3部分组成:**响应状态码、响应头和响应体**

#### 响应状态码

响应状态码表示服务器的响应状态, **200表示服务器正常响应**

其他响应状态码如下:

| 状态码 | 说明            | 详情                                                         |
| :----- | :-------------- | :----------------------------------------------------------- |
| 100    | 继续            | 请求者应当继续提出请求。服务器已收到请求的一部分, 正在等待其余部分 |
| 101    | 切换协议        | 请求者已要求服务器切换协议, 服务器已确认并准备切换           |
| 200    | 成功            | 服务器已成功处理了请求                                       |
| 201    | 已创建          | 请求成功并且服务器创建了新的资源                             |
| 202    | 已接受          | 服务器已接受请求, 但尚未处理                                 |
| 203    | 非授权信息      | 服务器已成功处理了请求, 但返回的信息可能来自另一个源         |
| 204    | 无内容          | 服务器成功处理了请求, 但没有返回任何内容                     |
| 205    | 重置内容        | 服务器成功处理了请求, 内容被重置                             |
| 206    | 部分内容        | 服务器成功处理了部分请求                                     |
| 300    | 多种选择        | 针对请求, 服务器可执行多种操作                               |
| 301    | 永久移动        | 请求的网页已永久移动到新位置, 即永久重定向                   |
| 302    | 临时移动        | 请求的网页暂时跳转到其他页面, 即暂时重定向                   |
| 303    | 查看其他位置    | 如果原来的请求是 POST, 重定向目标文档应该通过 GET 提取       |
| 304    | 未修改          | 此次请求返回的网页未修改, 继续使用上次的资源                 |
| 305    | 使用代理        | 请求者应该使用代理访问该网页                                 |
| 307    | 临时重定向      | 请求的资源临时从其他位置响应                                 |
| 400    | 错误请求        | 服务器无法解析该请求                                         |
| 401    | 未授权          | 请求没有进行身份验证或验证未通过                             |
| 403    | 禁止访问        | 服务器拒绝此请求                                             |
| 404    | 未找到          | 服务器找不到请求的网页                                       |
| 405    | 方法禁用        | 服务器禁用了请求中指定的方法                                 |
| 406    | 不接受          | 无法使用请求的内容响应请求的网页                             |
| 407    | 需要代理授权    | 请求者需要使用代理授权                                       |
| 408    | 请求超时        | 服务器请求超时                                               |
| 409    | 冲突            | 服务器在完成请求时发生冲突                                   |
| 410    | 已删除          | 请求的资源已永久删除                                         |
| 411    | 需要有效长度    | 服务器不接受不含有效内容长度标头字段的请求                   |
| 412    | 未满足前提条件  | 服务器未满足请求者在请求中设置的其中一个前提条件             |
| 413    | 请求实体过大    | 请求实体过大, 超出服务器的处理能力                           |
| 414    | 请求 URI 过长   | 请求网址过长, 服务器无法处理                                 |
| 415    | 不支持类型      | 请求格式不被请求页面支持                                     |
| 416    | 请求范围不符    | 页面无法提供请求的范围                                       |
| 417    | 未满足期望值    | 服务器未满足期望请求标头字段的要求                           |
| 500    | 服务器内部错误  | 服务器遇到错误, 无法完成请求                                 |
| 501    | 未实现          | 服务器不具备完成请求的功能                                   |
| 502    | 错误网关        | 服务器作为网关或代理, 从上游服务器收到无效响应               |
| 503    | 服务不可用      | 服务器目前无法使用                                           |
| 504    | 网关超时        | 服务器作为网关或代理, 但是没有及时从上游服务器收到请求       |
| 505    | HTTP 版本不支持 | 服务器不支持请求中所用的 HTTP 协议版本                       |

#### 响应头

响应头包含了服务器对请求的应答信息,如 Content-Type、Server、Set-Cookie 等。下面简要说明一些常用的头信息。

* Date: 标识响应产生的时间。
* Last-Modified: 指定资源的最后修改时间。
* Content-Encoding: 指定响应内容的编码。
* Server: 包含服务器的信息, 比如名称、版本号等。
* Content-Type: 文档类型, 指定返回的数据类型是什么, 如 text/html 代表返回 HTML 文档, application/x-javascript 则代表返回 JavaScript 文件, image/jpeg 则代表返回图片。
* Set-Cookie: 设置 Cookies。响应头中的 Set-Cookie 告诉浏览器需要将此内容放在 Cookies 中, 下次请求携带 Cookies 请求。
* Expires: 指定响应的过期时间, 可以使代理服务器或浏览器将加载的内容更新到缓存中。如果再次访问时, 就可以直接从缓存中加载, 降低服务器负载, 缩短加载时间。

#### 响应体

响应的数据均在响应体中, 在做爬虫时, 我们就是通过**响应体来得到网页源代码、JSON数据**,然后利用**解析器如正则表达式、xpath、CSS选择器等**来获取我们想要的数据

## TCP/IP协议

TCP/IP协议（Transmission Control Protocol/Internet Protocol）是Internet互联网最基本的协议, 将协议分成四个层次, 它们分别是链路层、网络层、传输层和应用层。TCP/IP协议族按照层次由上到下, 层层包装

## Robots协议

* Robots协议又称为**爬虫协议**、机器人协议等, 其全称是Robots Exclusion Protocol, 即“网络爬虫排除协议”。是互联网爬虫的一项公认的道德规范
* 访问许可策略: 网站通过Robots协议告诉爬虫哪些页面可以抓取, 哪些页面不能抓取。该协议指定了某种标识的爬虫能够抓取的目录或不能抓取的目录

## HTPP和HTTPS协议

* 这是**访问资源所需要的协议类型**
* HTTP 的全称是 Hyper Text Transfer Protocol, 中文名叫做超文本传输协议, HTTP 协议是用于从网络传输超文本数据到本地浏览器的传送协议, 它能保证传送高效而准确地传送超文本文档。HTTP 由万维网协会（World Wide Web Consortium）和 Internet 工作小组 IETF（Internet Engineering Task Force）共同合作制定的规范, 目前广泛使用的是 HTTP 1.1 版本
* HTTPS 的全称是 Hyper Text Transfer Protocol over Secure Socket Layer, 是以安全为目标的 HTTP 通道, 简单讲是 HTTP 的安全版, 即 HTTP 下加入 SSL 层, 简称为 HTTPS